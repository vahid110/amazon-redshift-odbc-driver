name: learn-github-actions
run-name: ${{ github.actor }} is learning GitHub Actions
on:
  workflow_dispatch:
jobs:
  check-bats-version:
    runs-on: windows-latest
    strategy:
      matrix:
        architecture: [x64]  # or [x86] for 32-bit
    steps:
      # - name: Check WIX
      #   run : dir "C:\Program Files (x86)\WiX Toolset v3.14\bin"
      # - name: Add WiX toolkit to PATH
      #   shell: bash
      #   run: |
      #     echo "${WIX}bin"
      #     echo "${WIX}bin" >> $GITHUB_PATH

      - name: Install WiX 3.11
        run: |
          mkdir D:\wix311
          Invoke-WebRequest -Uri 'https://github.com/wixtoolset/wix3/releases/download/wix3111rtm/wix311-binaries.zip' -OutFile 'wix311-binaries.zip'
          Expand-Archive -Path 'wix311-binaries.zip' -DestinationPath 'D:\wix311'
          echo "D:\wix311" >> $GITHUB_PATH
          $env:PATH += ";D:\wix311"  # Add WiX directory to PATH
          candle
        shell: powershell
  
      - name: Checkout github repo (+ download lfs dependencies)
        uses: actions/checkout@v2
        with:
          lfs: true

      - name: Checkout LFS objects
        run: git lfs checkout

      - name: Build ODBC
        shell: cmd
        working-directory: ${{github.workspace}}/src/odbc/rsodbc
        run: |
          dir "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\VC\Auxiliary\Build\vcvarsall.bat"
          $env:PATH += ";D:\wix311"  # Add WiX directory to PATH
          ./package64.bat 2.0.0 13
        
